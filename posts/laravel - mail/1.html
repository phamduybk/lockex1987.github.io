<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <title>Laravel Sending Email</title>
  </head>
  <body>
    <p>Phải sửa cả 2 cấu hình <code>from.address</code> và <code>from.name</code>
      ở <code>config/mail.php</code> nữa.</p>
    <pre>'from' =&gt; [
    'address' =&gt; env('MAIL_FROM_ADDRESS', 'hello@example.com'),
    'name' =&gt; env('MAIL_FROM_NAME', 'Example'),
],</pre>
    <p>Nó sẽ hiển thị ở mail như sau:</p>
    <img alt="" src="images/alias.png">
    <p>Thêm 2 cấu hình <code>MAIL_FROM_ADDRESS</code> và <code>MAIL_FROM_NAME</code>
      ở <code>.env</code>.</p>
    <p>Mẫu email chung (gồm header, footer) khi gửi mail quên mật khẩu và xác
      nhận email ở
vendor/laravel/framework/src/Illuminate/Notifications/resources/views/email.blade.php.</p>
    <p>vendor/laravel/framework/src/Illuminate/Mail/resources/views/html/message.blade.php</p>
    <p>vendor/laravel/framework/src/Illuminate/Mail/resources/views/markdown/message.blade.php</p>
    <p><br>
    </p>
    <p><br>
    </p>
    <p><a href="https://www.tutorialspoint.com/laravel/laravel_sending_email.htm">https://www.tutorialspoint.com/laravel/laravel_sending_email.htm</a></p>
    <p>https://scotch.io/tutorials/ultimate-guide-on-sending-email-in-laravel</p>
    <p>https://giaphiep.com/docs/5.3/mail</p>
    <p>Laravel sử dụng thư viện SwiftMailer để gửi mail. Email template được tải
      như là cách sử dụng view, nghĩa là bạn sử dụng cú pháp Blade và fill dữ
      liệu vào template.</p>
    <p>Cú pháp của hàm send như sau:</p>
    <p>void send(string|array $view, array $data, Closure|string $callback)</p>
    <p>Các tham số là:</p>
    <ul>
      <li>
        <p>$view(string|array) – Tên của view chứa nội dung email</p>
      </li>
      <li>
        <p>$data(array) – Mảng dữ liệu để truyền cho view</p>
      </li>
      <li>
        <p>$callback – a Closure callback which receives a message instance,
          allowing you to customize the recipients, subject, and other aspects
          of the mail message</p>
      </li>
    </ul>
    <p></p>
    <p>Ở tham số thứ ba, closure $callback nhận một instance $message và với
      instance đó chúng ta có thể gọi các hàm sau để tùy chỉnh:</p>
    <ul>
      <li>$message → subject('Welcome to the Tutorials Point');</li>
      <li>$message → from('email@example.com', 'Mr. Example');</li>
      <li>$message → to('email@example.com');</li>
    </ul>
    <p>Một số hàm ít phổ biến hơn bao gồm:</p>
    <ul>
      <li>$message → sender('email@example.com', 'Mr. Example');</li>
      <li>$message → returnPath('email@example.com');</li>
      <li>$message → cc('email@example.com', 'Mr. Example');</li>
      <li>$message → bcc('email@example.com', 'Mr. Example');</li>
      <li>$message → replyTo('email@example.com', 'Mr. Example');</li>
      <li>$message → priority(2);</li>
    </ul>
    <p>Để đính kèm hoặc embed (là gì?) bạn có thể sử dụng các hàm sau:</p>
    <ul>
      <li>$message → attach('path/to/attachment.txt');</li>
      <li>$message → embed('path/to/attachment.jpg');</li>
    </ul>
    <p>Mail có thể được gửi với định dạng HTML hoặc là text. Mặc định là HTML.
      Để gửi dạng text có thể làm như sau:</p>
    <pre>Mail::send(['text' =&gt; 'text.view'], $data, $callback);
</pre>
    <p>Trong cú pháp trên, tham số thứ nhất là một mảng, có một phần tử với key
      là <code>text</code> và giá trị là view.</p>
    <h3>Ví dụ</h3>
    <p><b>Bước 1:</b> Cấu hình email ở file <code>.env</code>.</p>
    <p>Chú ý nếu bạn sử dụng Gmail có thể bạn phải enable 2-step verification.</p>
    <p>Bạn nên sử dụng mã hóa TLS với cổng 587, mới hơn so với mã hóa SSL với
      cổng 465.</p>
    <pre>MAIL_DRIVER = smtp
MAIL_HOST = smtp.gmail.com
MAIL_PORT = 587
MAIL_USERNAME = your-gmail-username-
MAIL_PASSWORD = your-application-specific-password
MAIL_ENCRYPTION = tls
</pre>
    <p><b>Bước 2:</b> Thêm file code in<code>
        app/Http/Controllers/MailController.php</code> như sau:</p>
    <pre>&lt;?php
namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Mail;
use App\Http\Requests;
use App\Http\Controllers\Controller;


class MailController extends Controller {

   public function basic_email(){
      $data = array('name' =&gt; "Virat Gandhi");
   
      Mail::send(['text' =&gt; 'mail'], $data, function($message) {
         $message-&gt;to('abc@gmail.com', 'Tutorials Point')-&gt;subject('Laravel Basic Testing Mail');
         $message-&gt;from('xyz@gmail.com','Virat Gandhi');
      });
      echo "Basic Email Sent. Check your inbox.";
   }

   public function html_email(){
      $data = array('name' =&gt; "Virat Gandhi");
      Mail::send('mail', $data, function($message) {
         $message-&gt;to('abc@gmail.com', 'Tutorials Point')-&gt;subject('Laravel HTML Testing Mail');
         $message-&gt;from('xyz@gmail.com','Virat Gandhi');
      });
      echo "HTML Email Sent. Check your inbox.";
   }

   public function attachment_email(){
      $data = array('name' =&gt; "Virat Gandhi");
      Mail::send('mail', $data, function($message) {
         $message-&gt;to('abc@gmail.com', 'Tutorials Point')-&gt;subject('Laravel Testing Mail with Attachment');
         $message-&gt;attach('C:\laravel-master\laravel\public\uploads\image.png');
         $message-&gt;attach('C:\laravel-master\laravel\public\uploads\test.txt');
         $message-&gt;from('xyz@gmail.com','Virat Gandhi');
      });
      echo "Email Sent with attachment. Check your inbox.";
   }
}</pre>
    <p><b>Bước 3:</b> Thêm file view <code>resources/views/mail.blade.php</code>.</p>
    <pre>&lt;h1&gt;Hi, {{ $name }}&lt;/h1&gt;
l&lt;p&gt;Sending Mail from Laravel.&lt;/p&gt;
</pre>
    <p><b>Bước 4:</b> Cấu hình route ở file&nbsp;<code>app/Http/routes.php</code>.</p>
    <pre>Route::get('sendbasicemail','MailController@basic_email');
Route::get('sendhtmlemail','MailController@html_email');
Route::get('sendattachmentemail','MailController@attachment_email');
</pre>
    <p><b>Bước 5:</b> Test bằng cách truy cập các địa chỉ và kiểm tra hộp thư.</p>
    <pre>http://localhost:8000/sendbasicemail
</pre>
    <pre>http://localhost:8000/sendhtmlemail
</pre>
    <pre>http://localhost:8000/sendattachmentemail
</pre><br>
    <p></p>
    <p>Connection could not be established with host</p>
    <p>Nếu bạn bị lỗi như trên, thì hãy thử thêm cấu hình sau vào file <code>config/mail.php</code>:</p>
    <pre>'stream' =&gt; [
    'ssl' =&gt; [
        'allow_self_signed' =&gt; true,
        'verify_peer' =&gt; false,
        'verify_peer_name' =&gt; false
    ],
]</pre>
    <p>Nguyên nhân là do mấy cái TLS, SSL.</p>
    <table>
      <tbody>
        <tr>
          <th>Protocol</th>
          <th>Published</th>
        </tr>
        <tr>
          <td>SSL 1.0</td>
          <td>Unpublished</td>
        </tr>
        <tr>
          <td>SSL 2.0</td>
          <td>1995</td>
        </tr>
        <tr>
          <td>SSL 3.0</td>
          <td>1996</td>
        </tr>
        <tr>
          <td>TLS 1.0</td>
          <td>1999</td>
        </tr>
        <tr>
          <td>TLS 1.1</td>
          <td>2006</td>
        </tr>
        <tr>
          <td>TLS 1.2</td>
          <td>2008</td>
        </tr>
        <tr>
          <td>TLS 1.3</td>
          <td>2018</td>
        </tr>
      </tbody>
    </table>
    <p> </p>
    <p><br>
    </p>
    <p><br>
    </p>
  </body>
</html>
