<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <title>Kỹ thuật phân nhánh (Branching) trong Git</title>
    <link href="style.css" rel="stylesheet">
  </head>
  <body>
    <article>
      <p>Trong khi làm việc với Git, bạn đã quá quen thuộc với việc chỉnh sửa mã
        nguồn, sau đó là commit mỗi khi chỉnh sửa xong và push lên remote
        repository nếu cần thiết. Nhưng bây giờ mình có một ví dụ đặt ra là mình
        muốn <strong>tạo một phiên bản thử nghiệm với mã nguồn đang làm việc
          trong working tree hiện tại mà không gây ảnh hưởng đến các code hiện
          tại</strong>. Vậy thì làm cách nào? Không lẽ clone một repository từ
        chính cái working tree hiện tại rồi sửa đổi hay sao? Như thế rất là mất
        công, mà lại không tối ưu và không thể đồng bộ hóa hoặc rất khó khăn để
        đồng bộ hóa.</p>
      <p>Mà trong Git, chúng ta sẽ sử dụng một giải pháp khác tuyệt vời hơn, dễ
        dàng hơn gọi là <strong>phân nhánh</strong> (<em>branching</em>), mà cụ
        thể là phân nhánh cái gì? Đó là phân nhánh trong working tree hiện tại
        bạn đang làm việc đấy, và mỗi nhánh chúng ta sẽ gọi nó là một <strong>branch</strong>.</p>
      <h3>Branch trong Git là gì?</h3>
      <p>Khi bắt đầu khởi tạo một repository hoặc clone một repository, bạn sẽ
        có một nhánh (branch) chính tên là <code>master</code>&nbsp;(bạn có thể
        hiểu master là một cái thân cây). Đây là branch&nbsp;mà sẽ chứa toàn bộ
        các mã nguồn chính trong repository.</p>
      <p>Đó là lý do tại sao, ở các phần trước khi chúng ta push hoặc pull hay
        làm một số việc khác thì lại có tham số <code>master</code>&nbsp;trong
        câu lệnh, đó nghĩa là chúng ta đang thực hiện thao tác trên branch&nbsp;<code>master</code>.</p>
      <figure id="attachment_23899" style="width: 614px"> <a href="http://img.thach.io/wp-content/uploads/2015/04/23193418/git-branching.png"
          onclick="__gaTracker('send', 'event', 'outbound-article', 'http://img.thach.io/wp-content/uploads/2015/04/23193418/git-branching.png', '');"
          rel="external nofollow" title="" target="_blank"><img src="images/9-git-branching.png"
            alt="git-branching"></a> <figcaption> Nhánh Master là nhánh chính
          mặc định trong working tree. Bạn có thể tạo ra một (hoặc nhiều nhánh
          mới) với tên là Develop chẳng hạn. </figcaption>
      </figure>
      <p>Bây giờ nếu bạn muốn tạo một sự thay đổi nào đó mà có thể trực tiếp sử
        dụng trên working tree hoặc commit, push lên repository mà không ảnh
        hưởng đến branch&nbsp;master thì sẽ cần tạo ra một branch mới với tên là
        <code>develop</code>&nbsp;chẳng hạn. Và từ đó mỗi khi bạn thực hiện lệnh
        checkout vào branch nào đó thì toàn bộ mã nguồn trên working tree của
        bạn sẽ được đổi sang môi trường dành cho branch đang checkout.</p>
      <p>Giờ mình lấy một ví dụ đơn giản, bên branch <code>master</code>&nbsp;bạn
        tạo một tập tin <em>master.html</em> rồi commit lên, lúc này khi bạn
        qua cái branch <code>develop</code>&nbsp;(đã được tạo trước đó) thì cái
        tập tin <em>master.html</em> kia sẽ không có vì nó đã được commit bởi
        branch<code> master</code>, không liên quan gì tới<code> develop</code>.
        Tương tự, các thay đổi của bạn bên <code>develop</code>&nbsp;cũng sẽ
        không ảnh hưởng gì tới bên <code>master</code>&nbsp;cả.&nbsp;Điều này
        có một cái thú vị là nó tương tác trực tiếp trên máy tính của bạn, ví dụ
        tập tin index.html của <code>master</code>&nbsp;có nội dung khác và
        index.html bên <code>develop</code>&nbsp;thì khi bạn dùng lệnh checkout
        là nội dung trên máy tính nó tự đổi tương ứng, đó là lý do bạn có thể
        test nhiều phiên bản trên máy tính mà không cần đổi thư mục, chỉ cần
        checkout cái branch.</p>
      <p>Giải thích thì hơi dài dòng, cứ vào làm ví dụ cụ thể cho dễ hiểu nhé.</p>
      <h3>HEAD – con trỏ vị trí</h3>
      <p>Trước khi nói tiếp về branch thì mình xin nói qua một xíu về<code> HEAD</code>.
        Trong Git, từ khóa HEAD sẽ tượng trưng cho con trỏ chỉ cho bạn biết bạn
        đang nằm ở đâu. Bây giờ hãy xem lại bài hướng dẫn đọc log commit của
        mình, tìm tới phần tối ưu log và cài vào. Sau đó gõ lệnh git lg thì bạn
        sẽ thấy từ khóa HEAD cho bạn biết bạn đang ở đâu trong working tree.</p>
      <p><a href="http://img.thach.io/wp-content/uploads/2015/04/23193418/git-head-tips.png"
          onclick="__gaTracker('send', 'event', 'outbound-article', 'http://img.thach.io/wp-content/uploads/2015/04/23193418/git-head-tips.png', '');"
          rel="external nofollow" title="" target="_blank"><img src="images/9-git-head-tips.png"
            alt="git-head-tips"></a></p>
      <p>Như ảnh trên thì có nghĩa là mình đang ở branch <code>master</code>.</p>
      <p>Ngoài ra còn một cách khác để kiểm tra đó là đọc tập tin&nbsp;<code>.git/HEAD</code></p>
      <pre><span style="color: #339966;"><strong>$</strong></span> cat .git/HEAD
ref: refs/heads/master</pre>
      <h3>Cách tạo một branch</h3>
      <p>Trước tiên bạn có thể xem toàn bộ các branch mà bạn đang có trong
        working tree bằng lệnh <code>git branch</code>. Sau đó nếu muốn tạo
        thêm branch, chỉ cần gõ lệnh <code>git branch tên_brand</code>. Ví dụ
        mình cần tạo branch<code> develop</code>.</p>
      <pre><span style="color: #339966;"><strong>$</strong></span> git branch develop</pre>
      <p>Bây giờ bạn có thể gõ lại lệnh <code>git branch</code>&nbsp;một lần
        nữa để xem sẽ thấy brand tên develop xuất hiện.</p>
      <h3>Checkout một branch</h3>
      <p>Checkout ở đây nghĩa là bạn truy cập kiểm tra mã nguồn trong branch đó
        để làm việc đấy. Để làm việc này, bạn sử dụng lệnh <code>git checkout
          tên_branch</code>.</p>
      <pre><span style="color: #339966;"><strong>$</strong></span> git checkout develop
Switched to branch 'develop'</pre>
      <p>Lúc này bạn đã đổi sang branch <code>develop</code>&nbsp;rồi, để kiểm
        tra chắc ăn bạn có thể gõ các lệnh kiểm tra HEAD ở trên.</p>
      <p>Bây giờ bạn sẽ làm việc trong branch mới chuyển hay nói đúng hơn là bạn
        đang làm việc ở chỗ mà cái HEAD đang trỏ tới. Để chuyển về branch chính
        thì gõ <code>git checkout master</code>.</p>
      <p>Bây giờ bạn thử tạo một tập tin nào đó, sau đó commit ở branch <code>develop</code>&nbsp;rồi
        chuyển về branch master sẽ thấy những gì bạn đã làm ở branch <code>develop</code>&nbsp;hoàn
        toàn vô nghĩa ở <code>master</code>. Dưới đây là ví dụ về việc ở branch
        <code>master</code>&nbsp;không có tập tin develop.html được tạo ra từ
        branch&nbsp;<code>develop</code>.</p>
      <pre><span style="color: #339966;"><strong>$</strong></span> <strong>touch develop.html</strong>
<span style="color: #339966;"><strong>$</strong></span> <strong>git add .</strong>
<span style="color: #339966;"><strong>$</strong></span> <strong>git commit -m "Commit develop.html from develop branch"</strong>
[develop 8c68896] Commit develop.html from develop branch
 1 file changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 develop.html
<span style="color: #339966;"><strong>$</strong></span> <strong>git checkout master</strong>
Switched to branch 'master'
Your branch is ahead of 'thach/master' by 3 commits.
 (use "git push" to publish your local commits)
<span style="color: #339966;"><strong>$</strong></span> <strong>ls</strong>
faq.html README.md tag.html version1.txt</pre>
      <p>Tương tự với việc sửa tập tin hay bất kỳ làm việc gì khác nó cũng chỉ
        áp dụng thay đổi ở branch bạn đang trỏ tới.</p>
      <h3>Gộp dữ liệu từ một branch</h3>
      <p>Nếu mỗi branch nó nằm riêng như vậy thì bạn muốn sử dụng các thay đổi ở
        một branch nào đó cho master thì sao? À, chúng ta có thể sử dụng lệnh
        git merge để chuyển dữ liệu từ một branch nào đó về branch mà bạn đang
        trỏ đến. Lưu ý là ở branch cần chuyển về đã phải được commit. Ví dụ mình
        cần chuyển dữ liệu từ branch develop về master thì sẽ làm lần lượt các
        lệnh sau:</p>
      <pre><span style="color: #339966;"><strong>$</strong></span> <strong>git checkout master</strong>
Already on 'master'
Your branch is ahead of 'thach/master' by 3 commits.
 (use "git push" to publish your local commits)
<span style="color: #339966;"><strong>$</strong></span> <strong>git merge develop</strong>
Updating 83e9976..8c68896
Fast-forward
 develop.html | 0
 1 file changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 develop.html
<span style="color: #339966;"><strong>$</strong></span> <strong>ls</strong>
develop.html faq.html README.md tag.html version1.txt</pre>
      <h3>Xóa branch</h3>
      <p>Nếu bạn không cần dùng tới branch nào nữa thì có thể xóa với lệnh git
        branch -d tên_branch. Lưu ý là cái branch muốn xóa phải được gộp dữ liệu
        (merge) về master.</p>
      <pre><span style="color: #339966;"><strong>$</strong></span> <strong>git branch -d develop</strong>
Deleted branch develop (was 8c68896).</pre>
      <p>Sau khi xóa xong, nó sẽ báo branch đó đã được móc vào commit với mã
        checksum&nbsp;nào (8c68896).</p>
      <h3>Làm việc với remote branch</h3>
      <p>Quay lại một xíu với bài remote repository, bây giờ bạn hãy tạo thêm
        một remote mới từ địa chỉ&nbsp;https://github.com/csswizardry/inuit.css
        và đặt tên cho remote này là inuit vào working tree của bạn.</p>
      <pre><span style="color: #339966;"><strong>$</strong></span> <strong>git remote add inuit https://github.com/csswizardry/inuit.css</strong>
<span style="color: #339966;"><strong>$</strong></span> <strong>git remote -v</strong>
inuit https://github.com/csswizardry/inuit.css (fetch)
inuit https://github.com/csswizardry/inuit.css (push)
thach https://github.com/thachphamblog/hoc-git.git (fetch)
thach https://github.com/thachphamblog/hoc-git.git (push)</pre>
      <p>Bây giờ bạn có thể xem toàn bộ branch của cái remote <code>inuit</code>&nbsp;mới
        thêm vào bằng lệnh <code>git remote show inuit</code>.</p>
      <pre><span style="color: #339966;"><strong>$</strong></span> <strong>git remote show inuit</strong>
 * remote inuit
 Fetch URL: https://github.com/csswizardry/inuit.css
 Push URL: https://github.com/csswizardry/inuit.css
 HEAD branch: master
 Remote branches:
 feature/docs new (next fetch will store in remotes/inuit)
 feature/grids new (next fetch will store in remotes/inuit)
 fix/beautons new (next fetch will store in remotes/inuit)
 fix/grids new (next fetch will store in remotes/inuit)
 gh-pages new (next fetch will store in remotes/inuit)
 incoming new (next fetch will store in remotes/inuit)
 master new (next fetch will store in remotes/inuit)
 v5.0.1 new (next fetch will store in remotes/inuit)
 v5.1 new (next fetch will store in remotes/inuit)
 v5.1.0 new (next fetch will store in remotes/inuit)</pre>
      <p>Bây giờ bạn có thể chọn một cái remote branche cần fetch dữ liệu
        về.&nbsp;Ví dụ bây giờ mình sẽ tạo một branch mới cho working tree của
        mình tên là<code> fix_ui</code>, sau đó nạp dữ liệu trong&nbsp;branch <code>gh-pages</code>&nbsp;của<code>
          inuit</code> thì mình sẽ lần lượt làm như sau.</p>
      <pre><span style="color: #339966;"><strong>$</strong></span> <strong>git branch fix_ui</strong>
<span style="color: #339966;"><strong>$</strong></span> <strong>git checkout fix_ui</strong>
Switched to branch 'fix_ui'
<span style="color: #339966;"><strong>$</strong></span> <strong>git pull inuit gh-pages</strong>
warning: no common commits
remote: Counting objects: 309, done.
remote: Compressing objects: 100% (33/33), done.
remote: Total 309 (delta 4), reused 2 (delta 2), pack-reused 274
Receiving objects: 100% (309/309), 135.63 KiB | 0 bytes/s, done.
Resolving deltas: 100% (106/106), done.
From https://github.com/csswizardry/inuit.css
 * branch gh-pages -&gt; FETCH_HEAD
 * [new branch] gh-pages -&gt; inuit/gh-pages
Auto-merging README.md	
CONFLICT (add/add): Merge conflict in README.md
Automatic merge failed; fix conflicts and then commit the result.</pre>
      <p>Có thể nó sẽ xảy ra lỗi conflict khi gộp file README.md cũng không quan
        trọng lắm nên bạn có thể bỏ qua bằng cách gõ lệnh <code>git add
          README.md</code>&nbsp;để track file này, vì bây giờ nếu bạn gõ lệnh <code>ls</code>&nbsp;ra
        thì đã có các file từ inuit rồi.</p>
      <p>Bây giờ bạn có thể&nbsp;commit nó và thử push nó lên repository của
        bạn.</p>
      <pre><span style="color: #339966;"><strong> $</strong></span> <strong>git commit -m "Commit from fix_ui"</strong>
 [fix_ui c1eb301] Commit from fix_ui
 <span style="color: #339966;"><strong>$</strong></span> <strong>git push thach fix_ui</strong>
 Username for 'https://github.com': thachphamblog
 Password for 'https://thachphamblog@github.com':
 Counting objects: 317, done.
 Delta compression using up to 4 threads.
 Compressing objects: 100% (201/201), done.
 Writing objects: 100% (317/317), 135.77 KiB | 0 bytes/s, done.
 Total 317 (delta 113), reused 304 (delta 106)
 To https://github.com/thachphamblog/hoc-git.git
 * [new branch] fix_ui -&gt; fix_ui</pre>
      <p>Nhắc lại rằng, <code>thach</code>&nbsp;nghĩa là tên remote của
        repository mà mình cần push lên và <code>fix_ui</code>&nbsp;là tên
        branch mình cần push. Và đây là kết quả sau khi push lên repository của
        mình.</p>
      <p><a href="http://img.thach.io/wp-content/uploads/2015/04/23193418/git-push-remote-branch.png"
          onclick="__gaTracker('send', 'event', 'outbound-article', 'http://img.thach.io/wp-content/uploads/2015/04/23193418/git-push-remote-branch.png', '');"
          rel="external nofollow" title="" target="_blank"><img src="images/9-git-push-remote-branch.png"
            alt="git-push-remote-branch"></a></p>
      <p>Và dĩ nhiên, bạn cũng có thể qua một branch khác và sử dụng lệnh<code>
          git merge</code> để gộp dữ liệu của branch này về.</p>
      <p>Ngoài ra, kiến thức về branch còn có một kỹ thuật nữa cũng khá thú vị
        mà khi làm việc nhóm có thể sẽ cần đến, đó là <strong>rebase branch</strong>
        với mục đích hoán đổi vị trí của những lần commit. Tuy nhiên ở đây là
        serie cơ bản nên mình sẽ không nói qua mà bạn chỉ cần sử dụng thành thạo
        các kỹ thuật mà mình đã liệt kê trong đây là được.</p>
      <h3>Lời kết</h3>
      <p>Vậy là tới đây mình đã kết thúc hướng dẫn xong các kỹ thuật quan trọng
        nhất trong Git mà bạn dù bất cứ sử dụng Git trong mục đích nào cũng phải
        sử dụng. Mình cũng đã hướng dẫn cặn kẽ nhất theo cách hiểu của mình theo
        hướng đơn giản nhất nên mình hy vọng bạn có thể hiểu nó. Tiếp tục ở bài
        sau, mình sẽ không nói qua về các kỹ thuật trong Git nữa mà mình sẽ giới
        thiệu cho các bạn một số dịch vụ máy chủ repository dành cho Git tốt
        nhất và đặc biệt là có gói miễn phí để bạn có thêm nhiều lựa chọn.</p>
    </article>
  </body>
</html>
