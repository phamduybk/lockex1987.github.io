<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <title>Guides</title>
  </head>
  <body>
    <h1>Guides</h1>
    <ul>
      <li><a href="https://laradock.io/#Digital-Ocean">Production Setup on
          Digital Ocean</a></li>
      <li><a href="https://laradock.io/#PHPStorm-Debugging">PHPStorm XDebug
          Setup</a></li>
      <li><a href="https://laradock.io/#Laravel-Dusk">Running Laravel Dusk Test</a></li>
    </ul>
    <h1>Production Setup on Digital Ocean</h1>
    <h2>Install Docker</h2>
    <ul>
      <li>Visit <a href="https://cloud.digitalocean.com/login">DigitalOcean</a>
        and login.</li>
      <li>Click the <code>Create Droplet</code> button.</li>
      <li>Open the <code>One-click apps</code> tab.</li>
      <li>Select Docker with your preferred version.</li>
      <li>Continue creating the droplet as you normally would.</li>
      <li>If needed, check your e-mail for the droplet root password.</li>
    </ul>
    <h2>SSH to your Server</h2>
    <p>Find the IP address of the droplet in the DigitalOcean interface. Use it
      to connect to the server.</p>
    <pre><code>ssh root@ipaddress
</code></pre>
    <p>You may be prompted for a password. Type the one you found within your
      e-mailbox. It’ll then ask you to change the password.</p>
    <p>You can now check if Docker is available:</p>
    <pre><code>$root@server:~# docker
</code></pre>
    <h2>Set Up Your Laravel Project</h2>
    <pre><code>$root@server:~# apt-get install git
$root@server:~# git clone https://github.com/laravel/laravel
$root@server:~# cd laravel
$root@server:~/laravel/ git submodule add https://github.com/Laradock/laradock.git
$root@server:~/laravel/ cd laradock
</code></pre>
    <h2>Install docker-compose command</h2>
    <pre><code>$root@server:~/laravel/laradock# curl -L https://github.com/docker/compose/releases/download/1.8.0/run.sh &gt; /usr/local/bin/docker-compose
$root@server:~/chmod +x /usr/local/bin/docker-compose
</code></pre>
    <h2>Enter the laradock folder and rename env-example to .env.</h2>
    <pre><code>$root@server:~/laravel/laradock# cp env-example .env
</code></pre>
    <h2>Create Your Laradock Containers</h2>
    <pre><code>$root@server:~/laravel/laradock# docker-compose up -d nginx mysql
</code></pre>
    <p>Note that more containers are available, find them in the <a href="http://laradock.io/introduction/#supported-software-containers">docs</a>
      or the <code>docker-compose.yml</code> file.</p>
    <h2>Go to Your Workspace</h2>
    <pre><code>docker-compose exec workspace bash
</code></pre>
    <h2>Install and configure Laravel</h2>
    <p>Let’s install Laravel’s dependencies, add the <code>.env</code> file,
      generate the key and give proper permissions to the cache folder.</p>
    <pre><code>$ root@workspace:/var/www# composer install
$ root@workspace:/var/www# cp .env.example .env
$ root@workspace:/var/www# php artisan key:generate
$ root@workspace:/var/www# exit
$root@server:~/laravel/laradock# cd ..
$root@server:~/laravel# sudo chmod -R 777 storage bootstrap/cache
</code></pre>
    <p>You can then view your Laravel site by visiting the IP address of your
      server in your browser. For example:</p>
    <pre><code>http://192.168.1.1
</code></pre>
    <p>It should show you the Laravel default welcome page.</p>
    <p>However, we want it to show up using your custom domain name, as well.</p>
    <h2>Using Your Own Domain Name</h2>
    <p>Login to your DNS provider, such as Godaddy, Namecheap.</p>
    <p>Point the Custom Domain Name Server to:</p>
    <pre><code>ns1.digitalocean.com
ns2.digitalocean.com
ns3.digitalocean.com
</code></pre>
    <p>Within DigitalOcean, you’ll need to change some settings, too.</p>
    <p>Visit: <a href="https://cloud.digitalocean.com/networking/domains">https://cloud.digitalocean.com/networking/domains</a></p>
    <p>Add your domain name and choose the server IP you’d provision earlier.</p>
    <h2>Serving Site With NGINX (HTTP ONLY)</h2>
    <p>Go back to command line.</p>
    <pre><code>$root@server:~/laravel/laradock# cd nginx
$root@server:~/laravel/laradock/nginx# vim laravel.conf
</code></pre>
    <p>Remove <code>default_server</code></p>
    <pre><code>    listen 80 default_server;
    listen [::]:80 default_server ipv6only=on;
</code></pre>
    <p>And add <code>server_name</code> (your custom domain)</p>
    <pre><code>    listen 80;
    listen [::]:80 ipv6only=on;
    server_name yourdomain.com;
</code></pre>
    <h2>Rebuild Your Nginx</h2>
    <pre><code>$root@server:~/laravel/laradock# docker-compose down
$root@server:~/laravel/laradock# docker-compose build nginx
</code></pre>
    <h2>Re Run Your Containers MYSQL and NGINX</h2>
    <pre><code>$root@server:~/laravel/laradock/nginx# docker-compose up -d nginx mysql
</code></pre>
    <p>View Your Site with HTTP ONLY (<a href="http://yourdomain.com/">http://yourdomain.com</a>)</p>
    <h2>Run Site on SSL with Let’s Encrypt Certificate</h2>
    <p>Note: You need to Use Caddy here Instead of Nginx</p>
    <p>To go Caddy Folders and Edit CaddyFile</p>
    <pre><code>$root@server:~/laravel/laradock# cd caddy
$root@server:~/laravel/laradock/caddy# vim Caddyfile
</code></pre>
    <p>Remove 0.0.0.0:80</p>
    <pre><code>0.0.0.0:80
root /var/www/public
</code></pre>
    <p>and replace with your <a href="https://yourdomain.com/">https://yourdomain.com</a></p>
    <pre><code>https://yourdomain.com
root /var/www/public
</code></pre>
    <p>uncomment tls</p>
    <pre><code>#tls self-signed
</code></pre>
    <p>and replace self-signed with your email address</p>
    <pre><code>tls serverbreaker@gmai.com
</code></pre>
    <p>This is needed Prior to Creating Let’s Encypt</p>
    <h2>Run Your Caddy Container without the -d flag and Generate SSL with Let’s
      Encrypt</h2>
    <pre><code>$root@server:~/laravel/laradock# docker-compose up  caddy
</code></pre>
    <p>You’ll be prompt here to enter your email… you may enter it or not</p>
    <pre><code>Attaching to laradock_mysql_1, laradock_caddy_1
caddy_1               | Activating privacy features...
caddy_1               | Your sites will be served over HTTPS automatically using Let's Encrypt.
caddy_1               | By continuing, you agree to the Let's Encrypt Subscriber Agreement at:
caddy_1               |   https://letsencrypt.org/documents/LE-SA-v1.0.1-July-27-2015.pdf
caddy_1               | Activating privacy features... done.
caddy_1               | https://yourdomain.com
caddy_1               | http://yourdomain.com
</code></pre>
    <p>After it finishes, press <code>Ctrl</code> + <code>C</code> to exit.</p>
    <h2>Stop All Containers and ReRun Caddy and Other Containers on Background</h2>
    <pre><code>$root@server:~/laravel/laradock# docker-compose down
$root@server:~/laravel/laradock# docker-compose up -d mysql caddy
</code></pre>
    <p>View your Site in the Browser Securely Using HTTPS (<a href="https://yourdomain.com/">https://yourdomain.com</a>)</p>
    <p>Note that Certificate will be Automatically Renew By Caddy</p>
    <blockquote>
      <p>References:</p>
      <ul>
        <li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-16-04">https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-16-04</a></li>
        <li><a href="https://www.digitalocean.com/products/one-click-apps/docker/">https://www.digitalocean.com/products/one-click-apps/docker/</a></li>
        <li><a href="https://docs.docker.com/engine/installation/linux/ubuntulinux/">https://docs.docker.com/engine/installation/linux/ubuntulinux/</a></li>
        <li><a href="https://docs.docker.com/compose/install/">https://docs.docker.com/compose/install/</a></li>
        <li><a href="https://caddyserver.com/docs/automatic-https">https://caddyserver.com/docs/automatic-https</a></li>
        <li><a href="https://caddyserver.com/docs/tls">https://caddyserver.com/docs/tls</a></li>
        <li><a href="https://caddyserver.com/docs/caddyfile">https://caddyserver.com/docs/caddyfile</a></li>
      </ul>
    </blockquote>
    <h1><br>
    </h1>
    <h1><br>
    </h1>
    <h1><br>
    </h1>
    <h1><br>
    </h1>
    <h1>PHPStorm XDebug Setup</h1>
    <ul>
      <li><a href="https://laradock.io/#Intro">Intro</a></li>
      <li><a href="https://laradock.io/#Installation">Installation</a>
        <ul>
          <li><a href="https://laradock.io/#CustomizeDockerCompose">Customize
              laradock/docker-compose.yml</a>
            <ul>
              <li><a href="https://laradock.io/#InstallCleanHouse">Clean House</a></li>
              <li><a href="https://laradock.io/#InstallLaradockDialTone">Laradock
                  Dial Tone</a></li>
              <li><a href="https://laradock.io/#AddToHosts">hosts</a></li>
              <li><a href="https://laradock.io/#FireWall">Firewall</a></li>
              <li><a href="https://laradock.io/#enablePhpXdebug">Enable xDebug
                  on php-fpm</a></li>
            </ul>
          </li>
          <li><a href="https://laradock.io/#InstallPHPStorm">PHPStorm Settings</a>
            <ul>
              <li><a href="https://laradock.io/#InstallPHPStormConfigs">Configs</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="https://laradock.io/#Usage">Usage</a>
        <ul>
          <li><a href="https://laradock.io/#UsageLaravel">Laravel</a>
            <ul>
              <li><a href="https://laradock.io/#UsagePHPStormRunExampleTest">Run
                  ExampleTest</a></li>
              <li><a href="https://laradock.io/#UsagePHPStormDebugExampleTest">Debug
                  ExampleTest</a></li>
              <li><a href="https://laradock.io/#UsagePHPStormDebugSite">Debug
                  Web Site</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="https://laradock.io/#SSHintoWorkspace">SSH into workspace</a>
        <ul>
          <li><a href="https://laradock.io/#InstallKiTTY">KiTTY</a></li>
        </ul>
      </li>
    </ul>
    <h2>Intro</h2>
    <p>Wiring up <a href="https://laravel.com/">Laravel</a>, <a href="https://github.com/Laradock/laradock">Laradock</a>
      [Laravel+Docker] and <a href="https://www.jetbrains.com/phpstorm/">PHPStorm</a>
      to play nice together complete with remote xdebug’ing as icing on top!
      Although this guide is based on <code>PHPStorm Windows</code>, you should
      be able to adjust accordingly. This guide was written based on Docker for
      Windows Native.</p>
    <h2>Installation</h2>
    <ul>
      <li>This guide assumes the following:
        <ul>
          <li>you have already installed and are familiar with Laravel, Laradock
            and PHPStorm.</li>
          <li>you have installed Laravel as a parent of <code>laradock</code>.
            This guide assumes <code>/c/_dk/laravel</code>.</li>
        </ul>
      </li>
    </ul>
    <h2>hosts</h2>
    <ul>
      <li>
        <p>Add <code>laravel</code> to your hosts file located on Windows 10 at
          <code>C:\Windows\System32\drivers\etc\hosts</code>. It should be set
          to the IP of your running container. Mine is: <code>10.0.75.2</code>
          On Windows you can find it by opening Windows <code>Hyper-V Manager</code>.</p>
        <ul>
          <li><img src="https://laradock.io/images/photos/PHPStorm/Settings/WindowsHyperVManager.png"></li>
        </ul>
      </li>
      <li>
        <p><a href="https://github.com/scottlerch/HostsFileEditor">Hosts File
            Editor</a> makes it easy to change your hosts file.</p>
        <ul>
          <li>Set <code>laravel</code> to your docker host IP. See <a href="https://laradock.io/images/photos/SimpleHostsEditor/AddHost_laravel.png">Example</a>.</li>
        </ul>
      </li>
    </ul>
    <h2>Firewall</h2>
    <p>Your PHPStorm will need to be able to receive a connection from PHP
      xdebug either your running workspace or php-fpm containers on port 9000.
      This means that your Windows Firewall should either enable connections
      from the Application PHPStorm OR the port.</p>
    <ul>
      <li>It is important to note that if the Application PHPStorm is NOT
        enabled in the firewall, you will not be able to recreate a rule to
        override that.</li>
      <li>Also be aware that if you are installing/upgrade different versions of
        PHPStorm, you MAY have orphaned references to PHPStorm in your Firewall!
        You may decide to remove orphaned references however in either case,
        make sure that they are set to receive public TCP traffic.</li>
    </ul>
    <h3>Edit laradock/docker-compose.yml</h3>
    <p>Set the following variables:</p>
    <pre><code>### Workspace Utilities Container ###############

    workspace:
        build:
            context: ./workspace
            args:
                - INSTALL_XDEBUG=true
                - INSTALL_WORKSPACE_SSH=true
                ...


### PHP-FPM Container #####################

    php-fpm:
        build:
            context: ./php-fpm
            args:
                - INSTALL_XDEBUG=true
                ...

</code></pre>
    <h3>Edit xdebug.ini files</h3>
    <ul>
      <li><code>laradock/workspace/xdebug.ini</code></li>
      <li><code>laradock/php-fpm/xdebug.ini</code></li>
    </ul>
    <p>Set the following variables:</p>
    <pre><code>xdebug.remote_autostart=1
xdebug.remote_enable=1
xdebug.remote_connect_back=1
xdebug.cli_color=1
</code></pre>
    <h3>Need to clean house first?</h3>
    <p>Make sure you are starting with a clean state. For example, do you have
      other Laradock containers and images? Here are a few things I use to clean
      things up.</p>
    <ul>
      <li>Delete all containers using <code>grep laradock_</code> on the names,
        see: <a href="https://linuxconfig.org/remove-all-containners-based-on-docker-image-name">Remove
          all containers based on docker image name</a>.</li>
    </ul>
    <p><code>docker ps -a | awk '{ print $1,$2 }' | grep laradock_ | awk '{print
        $1}' | xargs -I {} docker rm {}</code></p>
    <ul>
      <li>Delete all images containing <code>laradock</code>.</li>
    </ul>
    <p><code>docker images | awk '{print $1,$2,$3}' | grep laradock_ | awk
        '{print $3}' | xargs -I {} docker rmi {}</code>Note: This will only
      delete images that were built with <code>Laradock</code>, NOT <code>laradock/*</code>
      which are pulled down by <code>Laradock</code> such as <code>laradock/workspace</code>,
      etc. Note: Some may fail with:<code>Error response from daemon: conflict:
        unable to delete 3f38eaed93df (cannot be forced) - image has dependent
        child images</code></p>
    <ul>
      <li>I added this to my <code>.bashrc</code> to remove orphaned images.</li>
    </ul>
    <pre><code>dclean() {
    processes=`docker ps -q -f status=exited`
    if [ -n "$processes" ]; then
      docker rm $processes
    fi

    images=`docker images -q -f dangling=true`
    if [ -n "$images" ]; then
      docker rmi $images
    fi
}
</code></pre>
    <ul>
      <li>If you frequently switch configurations for Laradock, you may find
        that adding the following and added to your <code>.bashrc</code> or
        equivalent useful:</li>
    </ul>
    <pre><code># remove laravel* containers
# remove laravel_* images
dcleanlaradockfunction()
{
	echo 'Removing ALL containers associated with laradock'
	docker ps -a | awk '{ print $1,$2 }' | grep laradock | awk '{print $1}' | xargs -I {} docker rm {}

	# remove ALL images associated with laradock_
	# does NOT delete laradock/* which are hub images
	echo 'Removing ALL images associated with laradock_'
	docker images | awk '{print $1,$2,$3}' | grep laradock_ | awk '{print $3}' | xargs -I {} docker rmi {}

	echo 'Listing all laradock docker hub images...'
	docker images | grep laradock

	echo 'dcleanlaradock completed'
}
# associate the above function with an alias
# so can recall/lookup by typing 'alias'
alias dcleanlaradock=dcleanlaradockfunction
</code></pre>
    <h2>Let’s get a dial-tone with Laravel</h2>
    <pre><code># barebones at this point
docker-compose up -d nginx mysql

# run
docker-compose ps

# Should see:
          Name                        Command             State                     Ports
-----------------------------------------------------------------------------------------------------------
laradock_mysql_1            docker-entrypoint.sh mysqld   Up       0.0.0.0:3306-&gt;3306/tcp
laradock_nginx_1            nginx                         Up       0.0.0.0:443-&gt;443/tcp, 0.0.0.0:80-&gt;80/tcp
laradock_php-fpm_1          php-fpm                       Up       9000/tcp
laradock_volumes_data_1     true                          Exit 0
laradock_volumes_source_1   true                          Exit 0
laradock_workspace_1        /sbin/my_init                 Up       0.0.0.0:2222-&gt;22/tcp
</code></pre>
    <h2>Enable xDebug on php-fpm</h2>
    <p>In a host terminal sitting in the laradock folder, run: <code>./php-fpm/xdebug
        status</code> You should see something like the following:</p>
    <pre><code>xDebug status
laradock_php-fpm_1
PHP 7.0.9 (cli) (built: Aug 10 2016 19:45:48) ( NTS )
Copyright (c) 1997-2016 The PHP Group
Zend Engine v3.0.0, Copyright (c) 1998-2016 Zend Technologies
    with Xdebug v2.4.1, Copyright (c) 2002-2016, by Derick Rethans
</code></pre>
    <p>Other commands include <code>./php-fpm/xdebug start | stop</code>.</p>
    <p>If you have enabled <code>xdebug=true</code> in <code>docker-compose.yml/php-fpm</code>,
      <code>xdebug</code> will already be running when <code>php-fpm</code> is
      started and listening for debug info on port 9000.</p>
    <h2>PHPStorm Settings</h2>
    <ul>
      <li>
        <p>Here are some settings that are known to work:</p>
        <ul>
          <li>
            <p><code>Settings/BuildDeploymentConnection</code></p>
            <ul>
              <li><img src="https://laradock.io/images/photos/PHPStorm/Settings/BuildDeploymentConnection.png"></li>
            </ul>
          </li>
          <li>
            <p><code>Settings/BuildDeploymentConnectionMappings</code></p>
            <ul>
              <li><img src="https://laradock.io/images/photos/PHPStorm/Settings/BuildDeploymentConnectionMappings.png"></li>
            </ul>
          </li>
          <li>
            <p><code>Settings/BuildDeploymentDebugger</code></p>
            <ul>
              <li><img src="https://laradock.io/images/photos/PHPStorm/Settings/BuildDeploymentDebugger.png"></li>
            </ul>
          </li>
          <li>
            <p><code>Settings/EditRunConfigurationRemoteWebDebug</code></p>
            <ul>
              <li><img src="https://laradock.io/images/photos/PHPStorm/Settings/EditRunConfigurationRemoteWebDebug.png"></li>
            </ul>
          </li>
          <li>
            <p><code>Settings/EditRunConfigurationRemoteExampleTestDebug</code></p>
            <ul>
              <li><img src="https://laradock.io/images/photos/PHPStorm/Settings/EditRunConfigurationRemoteExampleTestDebug.png"></li>
            </ul>
          </li>
          <li>
            <p><code>Settings/LangsPHPDebug</code></p>
            <ul>
              <li><img src="https://laradock.io/images/photos/PHPStorm/Settings/LangsPHPDebug.png"></li>
            </ul>
          </li>
          <li>
            <p><code>Settings/LangsPHPInterpreters</code></p>
            <ul>
              <li><img src="https://laradock.io/images/photos/PHPStorm/Settings/LangsPHPInterpreters.png"></li>
            </ul>
          </li>
          <li>
            <p><code>Settings/LangsPHPPHPUnit</code></p>
            <ul>
              <li><img src="https://laradock.io/images/photos/PHPStorm/Settings/LangsPHPPHPUnit.png"></li>
            </ul>
          </li>
          <li>
            <p><code>Settings/LangsPHPServers</code></p>
            <ul>
              <li><img src="https://laradock.io/images/photos/PHPStorm/Settings/LangsPHPServers.png"></li>
            </ul>
          </li>
          <li>
            <p><code>RemoteHost</code> To switch on this view, go to: <code>Menu/Tools/Deployment/Browse
                Remote Host</code>.</p>
            <ul>
              <li><img src="https://laradock.io/images/photos/PHPStorm/RemoteHost.png"></li>
            </ul>
          </li>
          <li>
            <p><code>RemoteWebDebug</code></p>
            <ul>
              <li><img src="https://laradock.io/images/photos/PHPStorm/DebugRemoteOn.png"></li>
            </ul>
          </li>
          <li>
            <p><code>EditRunConfigurationRemoteWebDebug</code> Go to: <code>Menu/Run/Edit
                Configurations</code>.</p>
            <ul>
              <li><img src="https://laradock.io/images/photos/PHPStorm/Settings/EditRunConfigurationRemoteWebDebug.png"></li>
            </ul>
          </li>
          <li>
            <p><code>EditRunConfigurationRemoteExampleTestDebug</code> Go to: <code>Menu/Run/Edit
                Configurations</code>.</p>
            <ul>
              <li><img src="https://laradock.io/images/photos/PHPStorm/Settings/EditRunConfigurationRemoteExampleTestDebug.png"></li>
            </ul>
          </li>
          <li>
            <p><code>WindowsFirewallAllowedApps</code> Go to: <code>Control
                Panel\All Control Panel Items\Windows Firewall\Allowed apps</code>.</p>
            <ul>
              <li><img src="https://laradock.io/images/photos/PHPStorm/Settings/WindowsFirewallAllowedApps.png"></li>
            </ul>
          </li>
          <li>
            <p><code>hosts</code> Edit: <code>C:\Windows\System32\drivers\etc\hosts</code>.</p>
            <ul>
              <li>
                <p><img src="https://laradock.io/images/photos/PHPStorm/Settings/hosts.png"></p>
              </li>
              <li>
                <p><a href="https://laradock.io/#enablePhpXdebug">Enable xDebug
                    on php-fpm</a></p>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h2>Usage</h2>
    <h3>Run ExampleTest</h3>
    <ul>
      <li>right-click on <code>tests/ExampleTest.php</code>
        <ul>
          <li>Select: <code>Run 'ExampleTest.php'</code> or <code>Ctrl+Shift+F10</code>.</li>
          <li>Should pass!! You just ran a remote test via SSH!</li>
        </ul>
      </li>
    </ul>
    <h3>Debug ExampleTest</h3>
    <ul>
      <li>Open to edit: <code>tests/ExampleTest.php</code></li>
      <li>Add a BreakPoint on line 16: <code>$this-&gt;visit('/')</code></li>
      <li>right-click on <code>tests/ExampleTest.php</code>
        <ul>
          <li>Select: <code>Debug 'ExampleTest.php'</code>.</li>
          <li>Should have stopped at the BreakPoint!! You are now debugging
            locally against a remote Laravel project via SSH!</li>
          <li><img src="https://laradock.io/images/photos/PHPStorm/RemoteTestDebuggingSuccess.png"></li>
        </ul>
      </li>
    </ul>
    <h3>Debug WebSite</h3>
    <ul>
      <li>
        <p>In case xDebug is disabled, from the <code>laradock</code> folder
          run: <code>./php-fpm/xdebug start</code>.</p>
        <ul>
          <li>To switch xdebug off, run: <code>./php-fpm/xdebug stop</code></li>
        </ul>
      </li>
      <li>
        <p>Start Remote Debugging</p>
        <ul>
          <li><img src="https://laradock.io/images/photos/PHPStorm/DebugRemoteOn.png"></li>
        </ul>
      </li>
      <li>
        <p>Open to edit: <code>bootstrap/app.php</code></p>
      </li>
      <li>
        <p>Add a BreakPoint on line 14: <code>$app = new
            Illuminate\Foundation\Application(</code></p>
      </li>
      <li>
        <p>Reload <a href="http://laravel/">Laravel Site</a></p>
        <ul>
          <li>Should have stopped at the BreakPoint!! You are now debugging
            locally against a remote Laravel project via SSH!</li>
          <li><img src="https://laradock.io/images/photos/PHPStorm/RemoteDebuggingSuccess.png"></li>
        </ul>
      </li>
    </ul>
    <h2>Let’s shell into workspace</h2>
    <p>Assuming that you are in laradock folder, type: <code>ssh -i
        workspace/insecure_id_rsa -p2222 root@laravel</code> Cha Ching!!!! - <code>workspace/insecure_id_rsa.ppk</code>
      may become corrupted. In which case: - fire up <code>puttygen</code> -
      import <code>workspace/insecure_id_rsa</code> - save private key to <code>workspace/insecure_id_rsa.ppk</code></p>
    <h3>KiTTY</h3>
    <p><a href="http://www.9bis.net/kitty/">Kitty</a> KiTTY is a fork from
      version 0.67 of PuTTY.</p>
    <ul>
      <li>Here are some settings that are working for me:
        <ul>
          <li><img src="https://laradock.io/images/photos/KiTTY/Session.png"></li>
          <li><img src="https://laradock.io/images/photos/KiTTY/Terminal.png"></li>
          <li><img src="https://laradock.io/images/photos/KiTTY/Window.png"></li>
          <li><img src="https://laradock.io/images/photos/KiTTY/WindowAppearance.png"></li>
          <li><img src="https://laradock.io/images/photos/KiTTY/Connection.png"></li>
          <li><img src="https://laradock.io/images/photos/KiTTY/ConnectionData.png"></li>
          <li><img src="https://laradock.io/images/photos/KiTTY/ConnectionSSH.png"></li>
          <li><img src="https://laradock.io/images/photos/KiTTY/ConnectionSSHAuth.png"></li>
          <li><img src="https://laradock.io/images/photos/KiTTY/TerminalShell.png"></li>
        </ul>
      </li>
    </ul>
    <h1><br>
    </h1>
    <h1><br>
    </h1>
    <h1><br>
    </h1>
    <h1><br>
    </h1>
    <h1>Running Laravel Dusk Tests</h1>
    <ul>
      <li><a href="https://laradock.io/#option1-dusk">Option 1: Without Selenium</a></li>
      <li><a href="https://laradock.io/#option2-dusk">Option 2: With Selenium</a></li>
    </ul>
    <h2>Option 1: Without Selenium</h2>
    <ul>
      <li><a href="https://laradock.io/#option1-dusk-intro">Intro</a></li>
      <li><a href="https://laradock.io/#option1-workspace-setup">Workspace Setup</a></li>
      <li><a href="https://laradock.io/#option1-application-setup">Application
          Setup</a></li>
      <li><a href="https://laradock.io/#option1-choose-chrome-driver-version">Choose
          Chrome Driver Version (Optional)</a></li>
      <li><a href="https://laradock.io/#option1-run-dusk-tests">Run Dusk Tests</a></li>
    </ul>
    <h3>Intro</h3>
    <p>This is a guide to run Dusk tests in your <code>workspace</code>
      container with headless google-chrome and chromedriver. It has been tested
      with Laravel 5.4 and 5.5.</p>
    <h3>Workspace Setup</h3>
    <p>Update your .env with following entries:</p>
    <pre><code>...
# Install Laravel installer bin to setup demo app
WORKSPACE_INSTALL_LARAVEL_INSTALLER=true
...
# Install all the necessary dependencies for running Dusk tests
WORKSPACE_INSTALL_DUSK_DEPS=true
...
</code></pre>
    <p>Then run below to build your workspace.</p>
    <pre><code>docker-compose build workspace
</code></pre>
    <h3>Application Setup</h3>
    <p>Run a <code>workspace</code> container and you will be inside the
      container at <code>/var/www</code> directory.</p>
    <pre><code>docker-compose run workspace bash

/var/www#&gt; _
</code></pre>
    <p>Create new Laravel application named <code>dusk-test</code> and install
      Laravel Dusk package.</p>
    <pre><code>/var/www&gt; laravel new dusk-test
/var/www&gt; cd dusk-test
/var/www/dusk-test&gt; composer require --dev laravel/dusk
/var/www/dusk-test&gt; php artisan dusk:install
</code></pre>
    <p>Create <code>.env.dusk.local</code> by copying from <code>.env</code>
      file.</p>
    <pre><code>/var/www/dusk-test&gt; cp .env .env.dusk.local
</code></pre>
    <p>Update the <code>APP_URL</code> entry in <code>.env.dusk.local</code>
      to local Laravel server.</p>
    <pre><code>APP_URL=http://localhost:8000
</code></pre>
    <p>You will need to run chromedriver with <code>headless</code> and <code>no-sandbox</code>
      flag. In Laravel Dusk 2.x it is already set <code>headless</code> so you
      just need to add <code>no-sandbox</code> flag. If you on previous version
      1.x, you will need to update your <code>DustTestCase#driver</code> as
      shown below.</p>
    <pre><code>&lt;?php

...

abstract class DuskTestCase extends BaseTestCase
{
    ...

    /**
    * Update chrome driver with below flags
    */
    protected function driver()
    {
        $options = (new ChromeOptions)-&gt;addArguments([
            '--disable-gpu',
            '--headless',
            '--no-sandbox'
        ]);

        return RemoteWebDriver::create(
            'http://localhost:9515', DesiredCapabilities::chrome()-&gt;setCapability(
                ChromeOptions::CAPABILITY, $options
            )
        );
    }
}
</code></pre>
    <h3>Choose Chrome Driver Version (Optional)</h3>
    <p>You could choose to use either:</p>
    <ol>
      <li>Chrome Driver shipped with Laravel Dusk. (Default)</li>
      <li>Chrome Driver installed in <code>workspace</code> container.
        (Required tweak on DuskTestCase class)</li>
    </ol>
    <p>For Laravel 2.x, you need to update <code>DuskTestCase#prepare</code>
      method if you wish to go with option #2.</p>
    <pre><code>
&lt;?php

...
abstract class DuskTestCase extends BaseTestCase
{
    ...
    public static function prepare()
    {
        // Only add this line if you wish to use chrome driver installed in workspace container.
        // You might want to read the file path from env file.
        static::useChromedriver('/usr/local/bin/chromedriver');

        static::startChromeDriver();
    }
</code></pre>
    <p>For Laravel 1.x, you need to add <code>DuskTestCase#buildChromeProcess</code>
      method if you wish to go with option #2.</p>
    <pre><code>&lt;?php

...
use Symfony\Component\Process\ProcessBuilder;

abstract class DuskTestCase extends BaseTestCase
{
    ...

    /**
    * Only add this method if you wish to use chrome driver installed in workspace container
    */
    protected static function buildChromeProcess()
    {
        return (new ProcessBuilder())
            -&gt;setPrefix('chromedriver')
            -&gt;getProcess()
            -&gt;setEnv(static::chromeEnvironment());
    }

    ...
}
</code></pre>
    <h3>Run Dusk Tests</h3>
    <p>Run local server in <code>workspace</code> container and run Dusk tests.</p>
    <pre><code># alias to run Laravel server in the background (php artisan serve --quiet &amp;)
/var/www/dusk-test&gt; serve
# alias to run Dusk tests (php artisan dusk)
/var/www/dusk-test&gt; dusk

PHPUnit 6.4.0 by Sebastian Bergmann and contributors.

.                                                                   1 / 1 (100%)

Time: 837 ms, Memory: 6.00MB
</code></pre>
    <h2>Option 2: With Selenium</h2>
    <ul>
      <li><a href="https://laradock.io/#dusk-intro">Intro</a></li>
      <li><a href="https://laradock.io/#dns-setup">DNS Setup</a></li>
      <li><a href="https://laradock.io/#docker-compose">Docker Compose Setup</a></li>
      <li><a href="https://laradock.io/#laravel-dusk-setup">Laravel Dusk Setup</a></li>
      <li><a href="https://laradock.io/#running-tests">Running Laravel Dusk
          Tests</a></li>
    </ul>
    <h3>Intro</h3>
    <p>Setting up Laravel Dusk tests to run with Laradock appears be something
      that eludes most Laradock users. This guide is designed to show you how to
      wire them up to work together. This guide is written with macOS and Linux
      in mind. As such, it’s only been tested on macOS. Feel free to create pull
      requests to update the guide for Windows-specific instructions.</p>
    <p>This guide assumes you know how to use a DNS forwarder such as <code>dnsmasq</code>
      or are comfortable with editing the <code>/etc/hosts</code> file for
      one-off DNS changes.</p>
    <h3>DNS Setup</h3>
    <p>According to RFC-2606, only four TLDs are reserved for local testing<sup><a
          href="https://laradock.io/#fn:1">1</a></sup>:</p>
    <ul>
      <li><code>.test</code></li>
      <li><code>.example</code></li>
      <li><code>.invalid</code></li>
      <li><code>.localhost</code></li>
    </ul>
    <p>A common TLD used for local development is <code>.dev</code>, but newer
      versions of Google Chrome (such as the one bundled with the Selenium
      Docker image), will fail to resolve that DNS as there will appear to be a
      name collision.</p>
    <p>The recommended extension is <code>.test</code> for your Laravel web
      apps because you’re running tests. Using a DNS forwarder such as <code>dnsmasq</code>
      or by editing the <code>/etc/hosts</code> file, configure the host to
      point to <code>localhost</code>.</p>
    <p>For example, in your <code>/etc/hosts</code> file:</p>
    <pre><code>##
# Host Database
#
# localhost is used to configure the loopback interface
# when the system is booting.  Do not change this entry.
##
127.0.0.1       localhost
255.255.255.255 broadcasthost
::1             localhost
127.0.0.1       myapp.test
</code></pre>
    <p>This will ensure that when navigating to <code>myapp.test</code>, it
      will route the request to <code>127.0.0.1</code> which will be handled by
      Nginx in Laradock.</p>
    <h3>Docker Compose setup</h3>
    <p>In order to make the Selenium container talk to the Nginx container
      appropriately, the <code>docker-compose.yml</code> needs to be edited to
      accommodate this. Make the following changes:</p>
    <pre><code>...
selenium:
  ...
  depends_on:
  - nginx
  links:
  - nginx:&lt;your_domain&gt;
</code></pre>
    <p>This allows network communication between the Nginx and Selenium
      containers and it also ensures that when starting the Selenium container,
      the Nginx container starts up first unless it’s already running. This
      allows the Selenium container to make requests to the Nginx container,
      which is necessary for running Dusk tests. These changes also link the <code>nginx</code>
      environment variable to the domain you wired up in your hosts file.</p>
    <h3>Laravel Dusk Setup</h3>
    <p>In order to make Laravel Dusk make the proper request to the Selenium
      container, you have to edit the <code>DuskTestCase.php</code> file that’s
      provided on the initial installation of Laravel Dusk. The change you have
      to make deals with the URL the Remote Web Driver attempts to use to set up
      the Selenium session.</p>
    <p>One recommendation for this is to add a separate config option in your <code>.env.dusk.local</code>
      so it’s still possible to run your Dusk tests locally should you want to.</p>
    <h4>.env.dusk.local</h4>
    <pre><code>...
USE_SELENIUM=true
</code></pre>
    <h4>DuskTestCase.php</h4>
    <pre><code>abstract class DuskTestCase extends BaseTestCase
{
...
    protected function driver()
    {
        if (env('USE_SELENIUM', 'false') == 'true') {
            return RemoteWebDriver::create(
                'http://selenium:4444/wd/hub', DesiredCapabilities::chrome()
            );
        } else {
            return RemoteWebDriver::create(
                'http://localhost:9515', DesiredCapabilities::chrome()
            );
        }
    }
}
</code></pre>
    <h3>Running Laravel Dusk Tests</h3>
    <p>Now that you have everything set up, to run your Dusk tests, you have to
      SSH into the workspace container as you normally would:<code>docker-compose
        exec --user=laradock workspace bash</code></p>
    <p>Once inside, you can change directory to your application and run:</p>
    <p><code>php artisan dusk</code></p>
    <p>One way to make this easier from your project is to create a helper
      script. Here’s one such example:</p>
    <pre><code>#!/usr/bin/env sh

LARADOCK_HOME="path/to/laradock"

pushd ${LARADOCK_HOME}

docker-compose exec --user=laradock workspace bash -c "cd my-project &amp;&amp; php artisan dusk &amp;&amp; exit"
</code></pre>
    <p>This invokes the Dusk command from inside the workspace container but
      when the script completes execution, it returns your session to your
      project directory.</p>
    <hr>
    <ol>
      <li><a href="https://iyware.com/dont-use-dev-for-development/">Don’t Use
          .dev for Development</a> <a href="https://laradock.io/#fnref:1"><sup>[return]</sup></a></li>
    </ol>
    <h1><br>
    </h1>
    <p></p>
  </body>
</html>
