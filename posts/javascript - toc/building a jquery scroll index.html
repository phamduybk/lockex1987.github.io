<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=windows-1252" http-equiv="content-type">
    <title>Building a jquery Scroll Index</title>
  </head>
  <body>
    <h1>Building a jquery Scroll Index</h1>

    <h4>Table of Content:</h4>
    <ul data-toc></ul>

    <div><a href="http://shahmirj.com/blog/jquery-scroll-index">http://shahmirj.com/blog/jquery-scroll-index</a><br>
      <br>
      If you scroll down on this page you will see a black index appear on the
      left. This is designed using jQuery. First of all we need to understand
      the blog layout and clarify the rules.</div>
    <h2>Rules</h2>
    <p>We know that our blog div element is called <code>#blog_message</code>.
      Inside this div element there are many <code>H1</code>, <code>H2</code>,
      <code>H3</code> and <code>HN</code> elements. Given this rule we can use
      jQuery to look for and return all the <code>HN</code> elements we are
      interested in. For our case we only use <code>H2</code> and <code>H3</code>
      elements as using more will be overkill.</p>
    <h2>Populating our Index list</h2>
    <p>Our index element looks like the following to start off with</p>
    <pre><code>&lt;div id='blog_index'&gt;
    &lt;ul&gt;
        &lt;li tag='top'&gt;Top&lt;/li&gt;
    &lt;/ul&gt;
&lt;/div&gt;
</code></pre>
    <h3>The search loop</h3>
    <p>Using jquery we will fetch all <code>H2</code> and <code>H3</code> and
      append the results text into a <code>&lt;li&gt;</code> into our above
      unorderd list. To get all these elements we use the following code:</p>
    <p> </p>
    <pre><code>//This function creates a list of all items
h2n = 0;
h3n = 0;
$("#message &gt; h2, #message &gt; h3").each(function(i) {
    // Create the html DOM element in a variable
    list = $("&lt;li&gt;" + $(this).text() + "&lt;/li&gt;");

    // Add the tag attribute and populate it with the current tag type (H2/H3)
    list.attr("tag", $(this).prop("tagName"));

    // Set the correct n attribute for our tag, and increment the varable hXn by one
    if ($(this).prop("tagName") == "H2") { list.attr("n", h2n); h2n++; }
    else if ($(this).prop("tagName") == "H3") { list.attr("n", h3n); h3n++; }

    // Append our record
    $('#blog_index ul').append($(list));
});<br></code></pre>
    <p>the <code>.each(...)</code> function loops through each <code>H2</code>
      and <code>H3</code> element, and appends the text of the index element
      into our index list. We then also add attributes such as <code>tag</code>
      and <code>n</code>. Where attribute <code>tag</code> represents what the
      element originally was and the attribute <code>n</code> represents its
      iteration. We also use <code>hXn++</code> to add our iteration for each
      element type, this variable could really be added as an array but for now
      lets use variables.</p>
    <p>If you want nested elements, remove the <code>&gt;</code> sign from the
      <code>.each</code> element selector.</p>
    <h3>Styling</h3>
    <p>Before we can go any further we need to make our <code>&lt;div
        id='blog_index'&gt;</code> to use the <code>position:fixed</code>
      property, because scrolling will also scroll our div.</p>
    <h2>Scrolling</h2>
    <p>Now that we have a dynamic populated list, we now have to set it to
      scroll to its correct element. This is where the attribute <code>n</code>
      comes in handy, lets look at the code before we go any further:</p>
    <pre><code>// The handler for the list clicked objects
$('#blog_index ul li').live('click', function(){
    clicked = $(this);

    // Scroll to top, If the tag value of the clicked element was "top"
    if (clicked.attr("tag") == "top") 
    {   
        $('html, body').animate({scrollTop: 0}, 'slow');
        return true;
    }   

    // Store the pointer to the original element that the index represents
    // Printed out this should spell "#message H2:eq(4)"
    goto_ele = $("#message " + clicked.attr("tag") + ":eq(" + clicked.attr("n") + ")");

    // Scroll to the right element
    $('html, body')
        .stop(true,true)
        .animate(
            {
                // Go to the called elements top position
                scrollTop: goto_ele.offset().top
            },
            'fast'
        );

    return true;
});<br></code></pre>
    <p>The above code handlers the <code>top</code> function differently to the
      element function. If the <code>tag</code> attribute of the clicked
      element is equal to <code>top</code> then we just scroll our window to
      the top, otherwise:</p>
    <p>We store the referencing element into the <code>goto_ele</code>, this
      variable should be interpreted like the following for 3rd H2 of the
      message</p>
    <code>#message H2:eq(3)</code>
    <p>The <code>:eq(n)</code> refrences the nth element type. Once we know
      which element we are scrolling to we simply use the <code>.offset().top</code>
      call in jQuery as a reference to <code>scrollTo:</code> in <code>animate</code></p>
    <p>Note we use the <code>live</code> event handler as we want each element
      appended to have this handler. If we use <code>click</code> there will be
      no handler for the new appended elements. Make sure you read up on <code>live</code>
      handlers to understand why we use this in more detail.</p>
    <h2>html</h2>
    <code>&lt;div id='blog_index'&gt; &lt;ul&gt; &lt;li
      tag='top'&gt;Top&lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; &lt;div
      id='message'&gt; &lt;h2&gt;Hello Ladies and Gentlemen&lt;/h2&gt;
      &lt;p&gt;....&lt;/p&gt; &lt;h3&gt;Im Back!&lt;/h3&gt;
      &lt;p&gt;Cheers!&lt;/p&gt; &lt;/div&gt; </code>
    <p>Hope this helps. </p>
    <div class="by">
      <h2>By Shahmir Javaid</h2>
      <sub><b>16th Nov 2012</b></sub> </div>

      <script src="pure.toc.js"></script>
  </body>
</html>
