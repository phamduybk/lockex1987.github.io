<!doctype html>
<html>
 <head> 
  <meta content="text/html; charset=UTF-8" http-equiv="content-type"> 
  <title>Đồng bộ dữ liệu giữa MongoDB với Elasticsearch bằng Transporter</title> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <link rel="icon" href="../../images/favicon.png"> 
  <link rel="stylesheet" href="../../css/style.css"> 
  <meta name="description" content="Đồng bộ dữ liệu giữa MongoDB với Elasticsearch bằng Transporter">
 </head> 
 <body> 
  <article> 
   <h1>Đồng bộ dữ liệu giữa MongoDB với Elasticsearch bằng Transporter</h1> 
   <h2>1. Transporter là gì? Cài đặt transporter trên ubuntu.</h2> 
   <p>Transporter là một phần mềm mã nguồn mở để di chuyển / đồng bộ dữ liệu dữ liệu trên các kho dữ liệu khác nhau.</p> 
   <p>Các kho dữ liệu được đồng bộ ở đây có thể là database, files…</p> 
   <p>Dữ liệu được đọc từ kho dữ liệu nguồn (source) sau đó được chỉnh sửa, tách lọc… (transformer) rồi chuyển tới kho dữ liệu đích (sink) thông qua pipeline do bạn định nghĩa.</p> 
   <p>Cài đặt transport trên ubuntu</p> 
   <p>Download transporter:</p> 
   <ul> 
    <li>wget https://github.com/compose/transporter/releases/download/v0.5.2/transporter-0.5.2-linux-amd64</li> 
   </ul> 
   <p>(Download các phiên bản khác <a href="https://github.com/compose/transporter/releases/tag/v0.5.2" target="_blank">tại đây</a>)</p> 
   <p>Chuyển các file vừa tải về vào folder <code>/usr/local/bin/transporter</code> hoặc folder nào đó bạn thích.</p> 
   <ul> 
    <li>sudo mv transporter-*-linux-amd64 /usr/local/bin/transporter</li> 
   </ul> 
   <p>Run transporter</p> 
   <ul> 
    <li>chmod +x /usr/local/bin/transporter</li> 
   </ul> 
   <p>Kiểm tra transport sau khi cài đặt bằng lệnh <code>transporter</code></p> 
   <p><a href="https://stackjava.com/wp-content/uploads/2018/08/transporter-1.png"><img src="https://stackjava.com/wp-content/uploads/2018/08/transporter-1.png"></a></p> 
   <h2>2. Chuyển dữ liệu từ MongoDB sang Elasticsearch</h2> 
   <p>(Xem lại: <a href="https://stackjava.com/mongodb/huong-dan-cai-dat-mongodb-tren-linux-ubuntu-16-04.html">Hướng dẫn cài đặt MongoDB</a>)</p> 
   <p>(Xem lại: <a href="https://stackjava.com/elasticsearch/huong-dan-cai-dat-elasticsearch-tren-ubuntu-16-04.html">Hướng dẫn cài đặt Elasticsearch</a>)</p> 
   <p>Trong ví dụ này mình sẽ chuyển dữ liệu trong database <code>demo</code> sang elasticsearch.</p> 
   <p>B1: Tạo dữ liệu cho database <code>demo</code>:</p> 
   <ul> 
    <li>db.player.insert({'name':'ronaldo','position':'striker'})</li> 
    <li>db.player.insert({'name':'buffon','position':'goalkeeper'})</li> 
   </ul> 
   <p><a href="https://stackjava.com/wp-content/uploads/2018/08/transporter-2.png"><img src="https://stackjava.com/wp-content/uploads/2018/08/transporter-2.png"></a> <a href="https://stackjava.com/wp-content/uploads/2018/08/transporter-3.png"><img src="https://stackjava.com/wp-content/uploads/2018/08/transporter-3.png"></a></p> 
   <p>B2: Tạo pipeline để chuyển dữ liệu từ MongoDB sang Elasticsearch bằng lệnh:</p> 
   <ul> 
    <li>transporter init mongodb elasticsearch</li> 
   </ul> 
   <p><a href="https://stackjava.com/wp-content/uploads/2018/08/transporter-4.png"><img src="https://stackjava.com/wp-content/uploads/2018/08/transporter-4.png"></a></p> 
   <p>Kết quả là file <code>pipeline.js</code> được tạo ra, file này sẽ chứa các thông tin nguồn, đích của dữ liệu:</p> 
   <ul> 
    <li>pipeline.js</li> 
   </ul> 
   <ul> 
    <li>var source = mongodb({</li> 
    <li> "uri": "${MONGODB_URI}"</li> 
    <li> // "timeout": "30s",</li> 
    <li> // "tail": false,</li> 
    <li> // "ssl": false,</li> 
    <li> // "cacerts": ["/path/to/cert.pem"],</li> 
    <li> // "wc": 1,</li> 
    <li> // "fsync": false,</li> 
    <li> // "bulk": false,</li> 
    <li> // "collection_filters": "{}",</li> 
    <li> // "read_preference": "Primary"</li> 
    <li>})</li> 
    <li><br> </li> 
    <li>var sink = elasticsearch({</li> 
    <li> "uri": "${ELASTICSEARCH_URI}"</li> 
    <li> // "timeout": "10s", // defaults to 30s</li> 
    <li> // "aws_access_key": "ABCDEF", // used for signing requests to AWS Elasticsearch service</li> 
    <li> // "aws_access_secret": "ABCDEF" // used for signing requests to AWS Elasticsearch service</li> 
    <li> // "parent_id": "elastic_parent" // defaults to "elastic_parent" parent identifier for Elasticsearch</li> 
    <li>})</li> 
    <li><br> </li> 
    <li>t.Source("source", source, "/.*/").Save("sink", sink, "/.*/")</li> 
   </ul> 
   <p>Các bạn có thể tạo biến môi trường <code>MONGODB_URI</code> và <code>ELASTICSEARCH_URI</code> tương ứng hoặc có thể sửa trực tiếp vào file pipeline.js.</p> 
   <p>Ở đây mình tạo biến môi trường:</p> 
   <p><code>MONGODB_URI</code> sẽ là uri tới database <code>demo</code> trên mongodb</p> 
   <ul> 
    <li>export MONGODB_URI='mongodb://localhost/demo'</li> 
   </ul> 
   <p><code>ELASTICSEARCH_URI</code> sẽ là uri đích để chứa dữ liệu trên elasticsearch:</p> 
   <ul> 
    <li>export ELASTICSEARCH_URI='http://localhost:9200/demo'</li> 
   </ul> 
   <p>B3: chạy file pipeline.js để chuyển dữ liệu từ mongodb sang elasticsearch</p> 
   <ul> 
    <li>transporter run pipeline.js</li> 
   </ul> 
   <p>Kết quả:</p> 
   <p><a href="https://stackjava.com/wp-content/uploads/2018/08/transporter-5.png"><img src="https://stackjava.com/wp-content/uploads/2018/08/transporter-5.png"></a></p> 
   <p>Kiểm tra lại dữ liệu trên elasticsearch bằng lệnh:</p> 
   <ul> 
    <li>curl $ELASTICSEARCH_URI/_search?pretty=true</li> 
   </ul> 
   <p><a href="https://stackjava.com/wp-content/uploads/2018/08/transporter-6.png"><img src="https://stackjava.com/wp-content/uploads/2018/08/transporter-6.png"></a></p> 
   <p>Đó, tất cả dữ liệu trên database demo đã được chuyển sang elasticsearch.</p> 
   <p> </p> 
   <p>Okay, Done!</p> 
   <p>References:</p> 
   <p><a href="https://github.com/compose/transporter" target="_blank">https://github.com/compose/transporter</a></p> 
   <p><a href="https://www.digitalocean.com/community/tutorials/how-to-sync-transformed-data-from-mongodb-to-elasticsearch-with-transporter-on-ubuntu-16-04" target="_blank">https://www.digitalocean.com/…transporter-on-ubuntu-16-04</a></p> 
   <p></p> 
  </article> 
  <script src="../../js/docs.js"></script>  
 </body>
</html>