<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <title>External Merge and Diff Tools</title>
  </head>
  <body>
    <h2>External Merge and Diff Tools</h2>
    <p>Although Git has an internal implementation of diff, which is what we’ve
      been showing in this book, you can set up an external tool instead. You
      can also set up a graphical merge-conflict-resolution tool instead of
      having to resolve conflicts manually. We’ll demonstrate setting up the
      Perforce Visual Merge Tool (P4Merge) to do your diffs and merge
      resolutions, because it’s a nice graphical tool and it’s free.</p>
    <p>If you want to try this out, P4Merge works on all major platforms, so you
      should be able to do so. We’ll use path names in the examples that work on
      Mac and Linux systems; for Windows, you’ll have to change <code>/usr/bin</code>
      to an executable path in your environment.</p>
    <p>To begin, <a href="https://www.perforce.com/product/components/perforce-visual-merge-and-diff-tools">download
        P4Merge from Perforce</a>. Next, you’ll set up external wrapper scripts
      to run your commands. We’ll use the Mac path for the executable; in other
      systems, it will be where your <code>p4merge</code>binary is installed.
      Set up a merge wrapper script named <code>extMerge</code> that calls your
      binary with all the arguments provided:</p>
    <pre><code>$ vi /usr/bin/extMerge
#!/bin/sh
/c/Program\ Files/Perforce/p4merge.exe $*</code></pre>
    <p>The diff wrapper checks to make sure seven arguments are provided and
      passes two of them to your merge script. By default, Git passes the
      following arguments to the diff program:</p>
    <pre><code>path old-file old-hex old-mode new-file new-hex new-mode</code></pre>
    <p>Because you only want the <code>old-file</code> and <code>new-file</code>
      arguments, you use the wrapper script to pass the ones you need.</p>
    <pre><code>$ vi /usr/bin/extDiff
#!/bin/sh
[ $# -eq 7 ] &amp;&amp; /usr/bin/extMerge "$2" "$5"</code></pre>
    <p>You also need to make sure these tools are executable:</p>
    <pre><code>$ chmod +x /usr/bin/extMerge
$ chmod +x /usr/bin/extDiff</code></pre>
    <p>Now you can set up your config file to use your custom merge resolution
      and diff tools. This takes a number of custom settings: <code>merge.tool</code>
      to tell Git what strategy to use, <code>mergetool.&lt;tool&gt;.cmd</code>
      to specify how to run the command, <code>mergetool.&lt;tool&gt;.trustExitCode</code>
      to tell Git if the exit code of that program indicates a successful merge
      resolution or not, and <code>diff.external</code> to tell Git what
      command to run for diffs. So, you can either run four config commands</p>
    <pre><code>$ git config --global merge.tool extMerge
$ git config --global mergetool.extMerge.cmd 'extMerge "$BASE" "$LOCAL" "$REMOTE" "$MERGED"'
$ git config --global mergetool.extMerge.trustExitCode false
$ git config --global diff.external extDiff</code></pre>
    <p>or you can edit your <code>~/.gitconfig</code> file to add these lines:</p>
    <pre><code>[merge]
  tool = extMerge
[mergetool "extMerge"]
  cmd = extMerge "$BASE" "$LOCAL" "$REMOTE" "$MERGED"
  trustExitCode = false
[diff]
  external = extDiff</code></pre>
    <p>After all this is set, if you run diff commands such as this:</p>
    <pre><code>$ git diff 32d1776b1^ 32d1776b1</code></pre>
    <p>Instead of getting the diff output on the command line, Git fires up
      P4Merge, which looks something like this:</p>
    <p><img src="https://git-scm.com/book/en/v2/images/p4merge.png"></p>
    <p>If you try to merge two branches and subsequently have merge conflicts,
      you can run the command <code>git mergetool</code>; it starts P4Merge to
      let you resolve the conflicts through that GUI tool.</p>
    <p><br>
    </p>
    <p><br>
    </p>
    <p><br>
    </p>
    <p><br>
    </p>
    <p><br>
    </p>
    <p>The nice thing about this wrapper setup is that you can change your diff
      and merge tools easily. For example, to change your <code>extDiff</code>
      and <code>extMerge</code> tools to run the KDiff3 tool instead, all you
      have to do is edit your <code>extMerge</code> file:</p>
    <pre><code>$ cat /usr/bin/extMerge
#!/bin/sh
/Applications/kdiff3.app/Contents/MacOS/kdiff3 $*</code></pre>
    <p>Now, Git will use the KDiff3 tool for diff viewing and merge conflict
      resolution.</p>
    <p>Git comes preset to use a number of other merge-resolution tools without
      your having to set up the cmd configuration. To see a list of the tools it
      supports, try this:</p>
    <pre><code>$ git mergetool --tool-help
'git mergetool --tool=&lt;tool&gt;' may be set to one of the following:
        emerge
        gvimdiff
        gvimdiff2
        opendiff
        p4merge
        vimdiff
        vimdiff2

The following tools are valid, but not currently available:
        araxis
        bc3
        codecompare
        deltawalker
        diffmerge
        diffuse
        ecmerge
        kdiff3
        meld
        tkdiff
        tortoisemerge
        xxdiff

Some of the tools listed above only work in a windowed
environment. If run in a terminal-only session, they will fail.</code></pre>
    <p>If you’re not interested in using KDiff3 for diff but rather want to use
      it just for merge resolution, and the kdiff3 command is in your path, then
      you can run</p>
    <pre><code>$ git config --global merge.tool kdiff3</code></pre>
    <p>If you run this instead of setting up the <code>extMerge</code> and <code>extDiff</code>
      files, Git will use KDiff3 for merge resolution and the normal Git diff
      tool for diffs.</p>
  </body>
</html>
